<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Formatter</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23fdf6e3'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #fdf6e3;
            min-height: 100vh;
            padding: 40px;
            overflow: auto;
        }

        .output-content {
            font-size: 18px;
            line-height: 2.0;
        }

        /* Shiki output styling */
        pre {
            margin: 0;
            padding: 0;
            font-size: 18px;
            line-height: 2.0;
        }

        .error {
            color: #dc2626;
            font-size: 18px;
            line-height: 2.0;
        }

        .hidden-input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="outputArea"></div>
    <textarea class="hidden-input" id="inputText" autocomplete="off" spellcheck="false"></textarea>

    <script type="module">
        import { codeToHtml } from 'https://esm.sh/shiki@3.0.0';

        const inputText = document.getElementById('inputText');
        const outputArea = document.getElementById('outputArea');

        function formatJSON(jsonString) {
            try {
                const parsed = JSON.parse(jsonString);
                return JSON.stringify(parsed, null, 2);
            } catch (error) {
                throw new Error(`Invalid JSON: ${error.message}`);
            }
        }

        async function updateOutput(jsonString) {
            if (!jsonString || jsonString.trim() === '') {
                outputArea.innerHTML = '';
                return;
            }

            try {
                const formatted = formatJSON(jsonString);
                const highlighted = await codeToHtml(formatted, {
                    lang: 'json',
                    theme: 'everforest-light'
                });
                outputArea.innerHTML = highlighted;
            } catch (error) {
                outputArea.innerHTML = `<div class="error">${escapeHtml(error.message)}</div>`;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Handle paste events on the entire page
        document.addEventListener('paste', (e) => {
            e.preventDefault();
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            if (pastedText) {
                updateOutput(pastedText);
            }
        });

        // Handle drag and drop on the entire page
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            document.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        document.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                const file = files[0];
                if (file.type === 'application/json' || file.name.endsWith('.json')) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const content = event.target.result;
                        updateOutput(content);
                    };
                    reader.readAsText(file);
                } else {
                    // Try to read as text anyway, might be JSON without .json extension
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const content = event.target.result;
                        updateOutput(content);
                    };
                    reader.readAsText(file);
                }
            }
        });
    </script>
</body>

</html>